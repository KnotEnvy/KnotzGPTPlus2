<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KnotzGPT-Expert Edition</title>
    <link rel="stylesheet" href="styles.css">
    <style>
    </style>
  </head>
  <body>
    <div class="App">
      <aside class="sidemenu">
        <h1>KnotzGPT-Expert Edition</h1>
        <div class="side-menu-button">
          <span>+</span>
          Get Started!
        </div>
        <label for="temperature">Temperature:</label>
        <meter id="temperature-meter" min="0" max="2" value="0.7"></meter>
        <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" />

        <!-- Token count slider and meter -->
        <label for="token-count">Token Count:</label>
        <meter id="token-count-meter" min="0" max="4000" value="125"></meter>
        <input type="range" id="token-count" min="0" max="4000" step="50" value="125" />

        <!-- System start prompt input -->
        <label for="system-prompt">System Start Prompt:</label>
        <input type="text" id="system-prompt" placeholder="Magic Context happens here!" />

        <!-- Save Context button -->
        <button id="save-context-btn">Save Context</button>
        <button id="createEmbedding">Create Embedding</button>
        <button id="createEmbedding">Add to DB</button>
        <button id="botPurpose">Bots Purpose using Knotz Templates</button>
      </aside>
      <section class="chatbox">
        <div class="chat-container">


          <div id="chat-log" class="chat-log"></div>
          <div class="chat-input-holder">
            <form action="" id="form">
              <input
                type="text"
                id="message"
                name="message"
                aria-label="Enter your message"
                class="chat-input-textarea"
                rows="1"
                placeholder="Enter your message"
              />
            </form>
          </div>
        </div>
      </section>
    </div>
    <script>
        let messages = [];
        const chatLog = document.getElementById('chat-log');
        const message = document.getElementById('message');
        const form = document.getElementById('form');
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const messageText = message.value;
          const newMessage = { role: 'user', content: `${messageText}` };
          messages.push(newMessage);
          message.value = '';
          const messageElement = document.createElement('div');
          messageElement.classList.add('message');
          messageElement.classList.add('message--sent');
          messageElement.innerHTML = `<div class="message__text">${messageText}</div>`;
          chatLog.appendChild(messageElement);
          chatLog.scrollTop = chatLog.scrollHeight;
          fetch('http://localhost:4009', {
            method: 'POST',
            headers: {
              'Content-type': 'application/json',
            },
            mode: 'cors',
            body: JSON.stringify({
              messages,
            }),
          })
            .then((res) => res.json())
            .then((data) => {
              let newAssistantMessage = {
                role: 'assistant',
                content: `${data.completion.content}`,
              };
              messages.push(newAssistantMessage);
              const messageElement = document.createElement('div');
              messageElement.classList.add('message');
              messageElement.classList.add('message--received');
              messageElement.innerHTML = `<div class="message__text">${data.completion.content}</div>`;
              chatLog.appendChild(messageElement);
              chatLog.scrollTop = chatLog.scrollHeight;
            })
            .catch((error) => {
              console.error('Error:', error);
            });
        });
        // Update temperature and tokens values above sliders
        const temperatureSlider = document.getElementById("temperature");
        const tokensSlider = document.getElementById("tokens");
        const temperatureValue = document.getElementById("temperatureValue");
        const tokensValue = document.getElementById("tokensValue");

        temperatureSlider.addEventListener("input", () => {
          temperatureValue.textContent = temperatureSlider.value;
        });

        tokensSlider.addEventListener("input", () => {
          tokensValue.textContent = tokensSlider.value;
        });
      </script>
    </body>
</html>
